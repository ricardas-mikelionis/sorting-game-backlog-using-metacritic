/* funnel-relay version 2.6.16 - do the magic here 2022-08-03 11:11 */
trx=window.trx||{},trx.runcount=0,trx.runtime=function(){"use strict";trx.magicLinksEngine=null,trx.MagicLinks=class{static prepareDefaultSettings(e){return"object"!=typeof e.detection_rules&&(e.detection_rules={auto:!0,custom:[],exclude_urls:[],page_url_filter:""}),null==e.detection_rules.auto&&(e.detection_rules.auto=!0),null==e.detection_rules.auto_networks&&(e.detection_rules.auto_networks={amazon:!1,ls:!0,cj:!0,sas:!1,awin:!1,pj:!1,sl:!1,vl:!1,ir:!1,td:!1,wg:!1,pt:!1,al:!1,at:!1,tt:!1,ho:!1,tc:!1,bol:!1,afs:!1,rv:!1,wyf:!1,ef:!1,dc:!1,afy:!1,ebay:!1,rfs:!1,ct:!1,fo:!1,pap:!1,bhp:!1,eff:!1,fnc:!1,dd:!1,dynamic:!1}),e.detection_rules.custom instanceof Array||(e.detection_rules.custom=[]),e.detection_rules.exclude_urls instanceof Array||(e.detection_rules.exclude_urls=[]),null==e.detection_rules.page_url_filter&&(e.detection_rules.page_url_filter=""),null==e.detection_rules.amazon_no_append&&(e.detection_rules.amazon_no_append=!1),"object"!=typeof e.features&&(e.features={}),null==e.features.append_referrer&&(e.features.append_referrer={enabled:!0,attr_name:"referrer",new_query_param:!1}),null==e.features.asin_map&&(e.features.asin_map={enabled:!1}),null==e.features.asin_tag&&(e.features.asin_tag={enabled:!1}),null==e.features.wait_then_click&&(e.features.wait_then_click={enabled:!1}),null==e.features.use_beacon&&(e.features.use_beacon={enabled:!1}),null==e.features.observe&&(e.features.observe={enabled:!1}),null==e.features.urlchange&&(e.features.urlchange={enabled:!1}),null==e.features.iid_track&&(e.features.iid_track={enabled:!1}),null==e.features.new_window&&(e.features.new_window={enabled:!1}),null==e.features.attributes_forwarding&&(e.features.attributes_forwarding={enabled:!0,attributes:["utm_source","utm_campaign","utm_content","utm_medium","utm_term","gclid","fbclid","cntt"]}),null==e.features.append_timing&&(e.features.append_timing={enabled:!1,t_load:!1,t_clicked:!1,t_toclick:!1,new_query_param:!1}),null==e.features.append_attributes&&(e.features.append_attributes={enabled:!1,attributes:""}),null==e.features.track_events&&(e.features.track_events={enabled:!1,pageview:!1,clicks:!1,props_map:{xid:"prop1",link:"prop2",label:"prop3",referrer:"prop4",origin:"prop5"},props_map_custom:[]}),null==e.features.auto_optimize_link&&(e.features.auto_optimize_link={enabled:!1}),null==e.features.link_preview&&(e.features.link_preview={enabled:!1,show_icon:!1,show_metadata:!1,show_coupons:!1}),null==e.features.shorten_extra_param&&(e.features.shorten_extra_param={enabled:!1}),null==e.features.metadata&&(e.features.metadata={enabled:!1,selectors:""}),null==e.features.spot&&(e.features.spot={enabled:!1,link_rules:!1,asin_rules:!1,asin_per_page:!1,direct_deals:!1}),null==e.features.srs&&(e.features.srs={enabled:!1}),e}constructor(e){try{null==e&&(e=!0),null==t&&(t="prod"),this.isInRunFunction=!1,this._paramsBuffer={attr_forwarding:{},metadata:{},timing:{},urls:{},attr_append:{},page_trace:[],custom_meta:{}},this._xids={},this._autoRun=e,this.init(e)}catch(e){this._error(e,e.stack)}}init(){try{if(this._onPageSettings=trx.magic_links_settings||{},this._envSettings={"events_recording_env":"cbs","events_recording_api":"https://yoerzkeuj0.execute-api.us-east-1.amazonaws.com/Prod","app_key":"gsd65fgr0hgTTT","events_recording_iid":"https://trx-hub.com"},this._serverSettings={"detection_rules":{"auto":"false","page_url_filter":"","auto_networks":{"amazon":"false","awin":"false","cj":"false","dynamic":"false","ir":"false","ls":"false","sas":"false","sl":"false","pj":"false","td":"false","wg":"false","pt":"false","al":"false","at":"false","tt":"false","vg":"false","ho":"false","tc":"false","bol":"false","rv":"false","afs":"false","wyf":"false","ef":"false","dc":"false","afy":"false","ebay":"false","rfs":"false","fo":"false","ct":"false","pap":"false","bhp":"false","eff":"false","fnc":"false","dd":"false"},"amazon_no_append":"true"},"features":{"append_referrer":{"enabled":"false","attr_name":"referrer"},"spot":{"enabled":"false","link_rules":"false","asin_rules":"false","asin_per_page":"false","direct_deals":"false"},"asin_map":{"enabled":"false"},"asin_tag":{"enabled":"false","tags_required":"0"},"iid_track":{"enabled":"false"},"wait_then_click":{"enabled":"false"},"use_beacon":{"enabled":"false"},"observe":{"enabled":"false"},"urlchange":{"enabled":"false"},"new_window":{"enabled":"false"},"attributes_forwarding":{"enabled":"true","attributes":["utm_source","utm_campaign","utm_content","utm_medium","utm_term","ftag","gclid","fbclid"]},"append_timing":{"enabled":"false","t_load":"false","t_clicked":"false","t_toclick":"false"},"append_attributes":{"enabled":"false","attributes":""},"track_events":{"enabled":"false","pageview":"false","clicks":"true","analytics_code":"","props_map":{"xid":"prop1","link":"prop2","label":"prop3","referrer":"prop4","origin":"prop5"}},"link_preview":{"enabled":"false","show_icon":"false","show_metadata":"false","show_coupons":"false"},"link_optimization":{"enabled":"false","shortening_extra_param":"false"},"metadata":{"enabled":"true","selectors":"pageViewGuid | js::pageData.pageViewGuid"}},"dynamic_domains":[""],"profile":"metacritic","profile_name":"metacritic"},null==this._envSettings.events_recording_env&&(this._envSettings.events_recording_env="prod"),this._embedUrlToken="FR-EMBEDDED-RF",this._delimiter1="|",this._delimiter2="~",this._delimiter3="%40%40",this._delimiter4="-",this._logPrefix="FunnelRelay:: ",this._loadTime=Date.now(),this._links=[],this._links_unique={},this._customLinks=new Map,this._report={},this._exclude_urls_regex=[],this._iframed=window.self!==window.top,!0===this._iframed&&void 0!==document.referrer&&""!==document.referrer&&(trx.source=document.referrer),this._scriptEm=document.getElementById("funnel-relay-installer"),null!=this._scriptEm){if(!this._scriptEm.hasAttribute("data-property-id")||!this._scriptEm.hasAttribute("data-customer-id")||this._isEmpty(this._scriptEm.hasAttribute("data-property-id"))||this._isEmpty(this._scriptEm.hasAttribute("data-customer-id")))return void this._error("Missing one of the mandatory script attributes 'data-customer-id' and/or 'data-property-id'");this._customerId=this._scriptEm.getAttribute("data-customer-id"),this._propertyId=this._scriptEm.getAttribute("data-property-id"),this._isSimulator=this._scriptEm.hasAttribute("data-simulator")}else{if(!window.trxFrTag)return void this._error('Installation script is missing  id="funnel-relay-installer" attribute. Funnel Relay will not run');this._customerId=window.trxFrCustomerId,this._propertyId=window.trxFrPropertyId,this._isSimulator=!1}var e=/iPad|iPhone|iPod/.test(navigator.platform||"");this._new_window=!1,0==this._new_window&&void 0!==this._serverSettings.features&&void 0!==this._serverSettings.features.new_window&&!0===this._asBoolean(this._serverSettings.features.new_window.enabled)&&(this._new_window=!0),this._iid_track=!1,0==this._iid_track&&void 0!==this._serverSettings.features&&void 0!==this._serverSettings.features.iid_track&&!0===this._asBoolean(this._serverSettings.features.iid_track.enabled)&&(this._iid_track=!0),this._asin_map=!1,0==this._asin_map&&void 0!==this._serverSettings.features&&void 0!==this._serverSettings.features.asin_map&&!0===this._asBoolean(this._serverSettings.features.asin_map.enabled)&&(this._asin_map=!0),this._asin_tag=!1,0==this._asin_tag&&void 0!==this._serverSettings.features&&void 0!==this._serverSettings.features.asin_tag&&!0===this._asBoolean(this._serverSettings.features.asin_tag.enabled)&&(this._asin_tag=!0),this._use_beacon=e,0==this._use_beacon&&void 0!==this._serverSettings.features&&void 0!==this._serverSettings.features.use_beacon&&!0===this._asBoolean(this._serverSettings.features.use_beacon.enabled)&&(this._use_beacon=!0),void 0!==trx.amp_redirect&&1==trx.amp_redirect?this.ampRedirectNow():(this._prepareSettings(),this._prepareExcludeRegExp(),this._autoRun&&this.run(),this.retransmit_sotrage_items(),this._observe=!1,0==this._observe&&void 0!==this._serverSettings.features&&void 0!==this._serverSettings.features.observe&&!0===this._asBoolean(this._serverSettings.features.observe.enabled)&&(this._observe=!0),this._observe&&this.observe(),this._url_change=!1,0==this._url_change&&void 0!==this._serverSettings.features&&void 0!==this._serverSettings.features.urlchange&&!0===this._asBoolean(this._serverSettings.features.urlchange.enabled)&&(this._url_change=!0),void 0==trx.his&&this._url_change&&(trx.his=!0,this._debug("bind location change!"),history.pushState=(e=>(function t(){var i=e.apply(this,arguments);return window.dispatchEvent(new Event("pushstate")),window.dispatchEvent(new Event("locationchange")),i}))(history.pushState),history.replaceState=(e=>(function t(){var i=e.apply(this,arguments);return window.dispatchEvent(new Event("replacestate")),window.dispatchEvent(new Event("locationchange")),i}))(history.replaceState),window.addEventListener("popstate",()=>{window.dispatchEvent(new Event("locationchange"))}),window.addEventListener("locationchange",e=>{this._debug("location: "+document.location+", state: "+JSON.stringify(e.state)),this._runFeatures(!0)})))}catch(e){console.error("Magic Links 'init' procedure fail! Details: "+e),e.stack&&console.error(e.stack)}}observe(){if(void 0===trx.observer){var e=0,t={attributes:!0,childList:!0,subtree:!0};window.MutationObserver&&(trx.observer=new MutationObserver(function(i){e>1||1==(e+=1)&&(trx.observer.disconnect(),setTimeout(function(){this._links=[],this._debug("Rerun..."),this.run(),e=0,trx.observer.observe(document.body,t)}.bind(this),3e3))}.bind(this)),trx.observer.observe(document.body,t))}}retransmitlog(e){let t=this._envSettings.events_recording_api+"/log",i={method:"POST",mode:"cors",cache:"no-cache",credentials:"same-origin",headers:{"Content-Type":"application/json"},redirect:"follow",referrer:"*client",body:e};return navigator.sendBeacon&&this._use_beacon?navigator.sendBeacon(t,e):fetch(t,i).then(t=>{if(t.ok){let i="Write to events-recording service. Body:\n"+e;return this._isSimulator&&this._log(i),this._debug(i),t.json()}this._log("Fail to write event data. HTTP error, status = "+t.status)}).then(e=>{e&&e.message&&this._log(e.message)}).catch(e=>{this._log(e)})}retransmit(e){let t=this._envSettings.events_recording_api+"/write",i={method:"POST",mode:"cors",cache:"no-cache",credentials:"same-origin",headers:{"Content-Type":"application/json"},redirect:"follow",referrer:"*client",body:e};return navigator.sendBeacon&&this._use_beacon?navigator.sendBeacon(t,e):fetch(t,i).then(t=>{if(t.ok){let i="Write to events-recording service. Body:\n"+e;return this._isSimulator&&this._log(i),this._debug(i),t.json()}this._log("Fail to write event data. HTTP error, status = "+t.status)}).then(e=>{e&&e.message&&this._log(e.message)}).catch(e=>{this._log(e)})}retransmit_sotrage_items(){try{if("undefined"!=typeof Storage){let e="";for(let e=0;e<localStorage.length;e++){let t=localStorage.key(e);if(t.startsWith("fr_click_")){let e=localStorage.getItem(t);this.retransmit(e),localStorage.removeItem(t)}else if(t.startsWith("fr_log_")){let e=localStorage.getItem(t);this.retransmitlog(e),localStorage.removeItem(t)}}}}catch(e){this._debug(e)}}parseQueryString(e){var t={},i,r,s,n;for(s=0,n=(i=e.split("&")).length;s<n;s++)(r=i[s].split("="))[0]=r[0].replace("?",""),t[r[0]]=r[1];return t}ampRedirectNow(){this.targetUrl=null;let e=this.parseQueryString(location.search);if(!e.anchor_href)return;this.targetUrl=e.anchor_href;let t=document.getElementById("fr-link");if(t.href=decodeURIComponent(this.targetUrl),e.source&&(trx.source=decodeURIComponent(e.source)),e.referrer&&(trx.referrer=decodeURIComponent(e.referrer),window.history.length>0)){var i=window.history.pop();console.log(i)}this._prepareSettings(),this._prepareExcludeRegExp(),this.run(),0===this._links.length&&(this._debug("coundent find aff link"),location.href=t.href),this._collectClickTimeParams(),this._addMetadataFromRequest(e);let r=this._writeDataToEventsService(this._links[0],"AMP");this._use_beacon?(!0===r&&t.setAttribute("data-written","true"),t.click()):r.then(()=>{t.setAttribute("data-written","true"),t.click()})}_addMetadataFromRequest(e){if(void 0!==this._settings.features&&void 0!==this._settings.features.metadata){let t=this._settings.features.metadata;if(this._asBoolean(t.enabled)&&!this._isEmpty(t.selectors)){let i,r,s,n=t.selectors.split("\n");for(let t=0;t<n.length;t++)try{let s=n[t];if(this._isEmpty(s))this._log("Ignoring empty line in metadata settings.");else{let t=s.split("|");if(t.length>1){if(i=t[0].trim(),0===(r=t[1].trim()).length)continue;void 0===e[i]||this._isEmpty(e[i])||(this._paramsBuffer.metadata[i]=e[i])}else this._log("Invalid metadata line. Line must have name and Xpath value in this format: name | xpath ")}}catch(e){this._log(e)}}}}get onPageSettings(){return this._onPageSettings}get serverSettings(){return this._serverSettings.hasOwnProperty("SETTINGS_PLACEHOLDER")?{}:this._serverSettings}get paramsBuffer(){return this._paramsBuffer}static renderLinkPreview(e,t){let i=document.querySelector('iframe[data-ml-preview="'+e+'"]');if(null!=i)return void i.parentNode.removeChild(i);let r=document.querySelector('a[data-ml-id="'+e+'"]');if(null!=r){let t=document.createElement("iframe");t.setAttribute("data-ml-preview",e),t.setAttribute("scrolling","no"),t.setAttribute("frameborder","0"),t.style.borderStyle="solid",t.style.borderWidth="2px",t.style.borderColor="grey",t.style.borderRadius="3px",t.style.position="absolute",t.style.width="120px",t.style.height="90px",t.style.background="#fff";let i=document.documentElement,s=r.getBoundingClientRect();t.style.top=s.top+(window.pageYOffset-i.clientTop)-100+"px",t.style.left=s.left+(window.pageXOffset-i.clientLeft)+(s.width-60)+"px",document.body.appendChild(t);let n=t.contentWindow||t.contentDocument;n.document&&(n=n.document);let a=n.createElement("img"),o="http://images.shrinktheweb.com/xino.php?stwembed=1&stwaccesskeyid=4abc115f8a632c5&stwsize=120x90&stwurl="+r.href;a.setAttribute("src",o),a.style.width="100%",a.style.height="auto",n.body.appendChild(a),n.body.style.padding="1px"}t.stopImmediatePropagation()}run(){if(this.isInRunFunction)this._debug("Already in run function.");else{0===trx.runcount&&(trx.runcount=trx.runcount+1),this.isInRunFunction=!0;try{if(this._isEmpty(this._envSettings.events_recording_api))return void this._error("Missing environment settings. Check that you setup $ENV_SETTINGS in my.cfg.php and that 'events_recording_api' is set there!");if(!this._checkPageUrlMatch())return;if(document.links.length>0)for(let e=0;e<document.links.length;e++){let t=document.links[e];if(trx.magicLinksSimulator){let e=t.getAttribute("data-orig-url");this._isEmpty(e)||(t.href=e),t.removeAttribute("data-ml-dynamic-type"),t.removeAttribute("data-ml-dynamic"),t.removeAttribute("data-ml-id"),t.removeAttribute("data-xid"),t.removeAttribute("data-ml")}t.hasAttribute("data-skimlinks-tracking")&&t.setAttribute("data-skimlinks-tracking",this._cleanupXid(t.getAttribute("data-skimlinks-tracking")))}this._detectLinks(),this._disbaleLinks(),this._links.length>0&&(this._appendUUID(),this._runFeatures()),(this._asin_map||this._asin_tag)&&this._asinMapCall(),this._logPageTrace(),this._debug("Links count "+this._links.length);for(let e=0;e<this._links.length;e++){let t=this._links[e];t.info.dynamic||t.info.disable||(t.info.embedded?t.anchor.href=t.info.wrapping_url.replace(this._embedUrlToken,encodeURIComponent(t.info.url)):void 0!==t.info.selector_attribute?t.anchor.setAttribute(t.info.selector_attribute,t.info.url):t.anchor.href=t.info.url)}null!=r&&"true"===r.getAttribute("data-report")&&this._postReport(),void 0!==trx.SpotClient&&(trx.spotEngine=new trx.SpotClient(this),trx.spotEngine.start()),this._iid_track&&this._updateIID()}catch(e){this._error("'run' procedure fail! Details: "+e,e.stack),this.isInRunFunction=!1}this.isInRunFunction=!1}}_asinMapCall(){let e=this._customerId.split("_");if(this._envSettings.asin_map_api&&trx.LZString&&trx.md5&&e.length>1){let i=e[e.length-1],r=window.location.href,s=Object.keys(this._prepareAnchorASIN()).sort(),n=[this._envSettings.asin_map_api,i,"/",trx.md5(r+s.join(",")),"?client="+e[0]];this._asin_tag&&n.push("&tags=","1");var t={method:"GET",mode:"cors",cache:"no-cache",credentials:"same-origin",headers:{"Content-Type":"application/x-www-form-urlencoded"},redirect:"follow",referrer:"*client"};this._iframed&&(t.referrer=location.href),fetch(n.join("")+"&data="+trx.LZString.compressToEncodedURIComponent(JSON.stringify({url:r,asin:s})),t).then(e=>{e.text().then(e=>{})})}}_prepareAnchorASIN(){let e={};for(let t=0;t<document.links.length;t++){let i=document.links[t],r=i.href,s=i.getAttribute("data-orig-url"),n;if(this._isEmpty(s)||(r=s),"amazon"===this._detectKnownAffiliateLink(r,{})){let t=this._findAsin(r);null!==t&&(void 0==e[t]&&(e[t]=[]),e[t].push(i))}}return e}_updateIID(){var e=!1;if(void 0===trx.iid&&(e=!0,trx.iid=this._generateUUID().replace("fr","iid")),void 0!==trx.LZString&&void 0!==this._envSettings.events_recording_iid){if(e){let e=this._paramsBuffer;if(e.client_time=(new Date).toISOString(),e.page_title=document.title,e.iid=trx.iid,e.event_type="impression",void 0===e.customer_id){e.cidp1=e.customer_id=this._customerId;const t=this._paramsBuffer.customer_id.split("_");if(-1!==e.customer_id.indexOf("_")){const t=e.customer_id.split("_");if(t.length>2){let i=t.slice(0,t.length-1);e.cidp1=i.join("_"),e.cidp2=t[t.length-1]}}}var t=JSON.stringify(e),i=trx.LZString.compressToEncodedURIComponent(t);this._debug("Meta "+t.length+"  bytes decresed to "+i.length+" bytes ("+Math.round(100*i.length/t.length)+" %)");var r=this._envSettings.events_recording_iid+"/i/m/i.png?q="+i;if(this.pixel_append(r),r.length>=8e3)try{if("undefined"!=typeof Storage){var s,n="fr_log_"+(s=Math.round((new Date).getTime()/1e3)),a={},o;(o=this._getLogInfomration(a)).url=window.location.href,o.message="pixel too big "+r.length,localStorage.setItem(n,JSON.stringify(o))}}catch(e){this._debug(e)}}if(console.log("iid ll"+this._links.length),this._links.length>0){var l=[],d=25,c=0,h=0;for(var u in this._links)void 0===l[c]&&(l[c]={}),l[c][this._links[u].info.xid]=this._links[u].anchor.getAttribute("data-orig-url"),h>=25&&(c+=1,h=0),h+=1;for(var _=0;_<=c;_++)if(void 0!==l[_]){this._debug(l[_]);var f={pid:this._paramsBuffer.customer_id,iid:trx.iid,xids:l[_]},g=JSON.stringify(f),m=trx.LZString.compressToEncodedURIComponent(g);this._debug(g.length+" bytes decresed to "+m.length+" bytes ("+Math.round(100*m.length/g.length)+" %)");var r=this._envSettings.events_recording_iid+"/i/x/i.png?q="+m;if(this.pixel_append(r),r.length>=8e3)try{if("undefined"!=typeof Storage){var s,n="fr_log_"+(s=Math.round((new Date).getTime()/1e3)),a={},o;(o=this._getLogInfomration(a)).url=window.location.href,o.message="pixel too big "+r.length,localStorage.setItem(n,JSON.stringify(o))}}catch(e){this._debug(e)}}}}}pixel_append(e){var t=document.createElement("img");t.height="1",t.width="1",t.style="border-style:none;display:none;",t.alt="",t.src=e,document.body.appendChild(t)}registerCustomLinks(e){for(let[t,i]of e)this.registerCustomLink(t,i)}registerCustomLink(e,t){if(this._isEmpty(e)||this._isEmpty(t))this._error("registerCustomLink method was invoked with either empty 'id' or empty 'url' arguments. Check you call to method(s) 'registerCustomLink' / 'registerCustomLinks'");else{let i=document.getElementById(e);null!=i&&i.parentNode.removeChild(i),(i=document.createElement("a")).href=t,i.id=e,i.style.display="none",i.setAttribute("data-ml-custom-link","true"),i.setAttribute("target","_blank"),document.body.append(i),this._customLinks.set(e,{orig_url:t})}}getProcessedCustomLinks(){for(let[e,t]of this._customLinks){let i=document.getElementById(e);t.processed=i.hasAttribute("data-ml"),t.processed&&(t.fr_url=i.href)}return this._customLinks}recordCustomLinkClick(e,t){try{let i=!1;for(let r=0;r<this._links.length;r++){let s=this._links[r];if(s.anchor.id===e){let e={type:"custom-url"};this._linkClicked(s,e,t),i=!0;break}}i||this._error("recordCustomLinkClick was invoked with unrecognized id: '"+e+"'. The id should be the same as the value used when you invoked registerCustomLink(...) or registerCustomLinks(...)")}catch(e){this._error("Fail to trigger custom link. Details: "+e,e.stack)}}_runFeatures(e){if(this._paramsBuffer.origin=this.href,this._paramsBuffer.property_id=this._propertyId,this._paramsBuffer.customer_id=this._customerId,this._paramsBuffer.cidp1=this._paramsBuffer.customer_id,this._paramsBuffer.cidp2="-",-1!==this._paramsBuffer.customer_id.indexOf("_")){const e=this._paramsBuffer.customer_id.split("_");if(e.length>2){let t=e.slice(0,e.length-1);this._paramsBuffer.cidp1=t.join("_"),this._paramsBuffer.cidp2=e[e.length-1]}}this._paramsBuffer.source=location.href,void 0!==trx.source&&(this._paramsBuffer.source=trx.source,this._paramsBuffer.urls.source=trx.source,this._paramsBuffer.amp_source=location.href),this._paramsBuffer.event_type="click",this._prepareCustomMetadata();let t=this._settings.features;for(let i in t)if(t.hasOwnProperty(i)){let r=t[i];if(!this._asBoolean(r.enabled))continue;switch(i){case"append_referrer":this._appendReferrer(r);break;case"append_timing":this._appendTiming(r);break;case"append_attributes":this._appendAttributes(r);break;case"attributes_forwarding":this._attributesForwarding(r,e);break;case"track_events":this._prepareEventTracking(r);break;case"auto_optimize_link":this._autoOptimizeLinks(r);break;case"link_preview":this._preparePreview(r);break;case"shorten_extra_param":this._prepareShortExtraParam(r);break;case"metadata":this._prepareMetadata(r);break}}if(1!=e){for(let e=0;e<this._links.length;e++){let t=this._links[e];if(1==t.info.disable)continue;null!=t.anchor.click_fn&&"function"==typeof t.anchor.click_fn&&t.anchor.removeEventListener("click",t.anchor.click_fn);let i=this._linkClicked.bind(this,t);t.anchor.addEventListener("click",i),t.anchor.click_fn=i,null!=t.anchor.contextmenu_fn&&"function"==typeof t.anchor.contextmenu_fn&&t.anchor.removeEventListener("contextmenu",t.anchor.contextmenu_fn);let r=this._linkClicked.bind(this,t);t.anchor.addEventListener("contextmenu",r),t.anchor.contextmenu_fn=r}this._setSkimDynamicXcust()}}_setSkimDynamicXcust(){if(this._asBoolean(this._settings.detection_rules.auto_networks.dynamic))for(let e=0;e<this._links.length;e++){let t=this._links[e];if(t.info.dynamic&&"sl"===t.info.dynamicType){let e=t.anchor.hasAttribute("data-skimlinks-tracking")?t.anchor.getAttribute("data-skimlinks-tracking"):"";e=this._cleanupXid(e),this._isEmpty(e)||(e+="|"),e+="xid:"+t.info.xid,t.anchor.setAttribute("data-skimlinks-tracking",e)}}}_linkClicked(e,t,i){if("true"===e.anchor.getAttribute("data-written"))return void this._debug("click already saved.");if(e.info.dynamic){let t;if("vg"===e.anchor.getAttribute("data-ml-dynamic-type")){let t=vglnk.opt("cuid");t=this._cleanupXid(t),this._isEmpty(t)||(t+="|"),t+="xid:"+e.info.xid,vglnk.opt("cuid",t)}}this._collectClickTimeParams();let r=!1;if(void 0!==e.anchor&&"true"===(r=e.anchor.getAttribute("data-written")))return;let s=this._promiseTimeout(2e3,this._writeDataToEventsService(e,t.type,i));s.then(()=>{e.anchor.setAttribute("data-written","true")}),s.catch(t=>{try{if("undefined"!=typeof Storage){var i,r="fr_log_"+Math.round((new Date).getTime()/1e3),s=this._getLogInfomration(JSON.parse(JSON.stringify(this._paramsBuffer)));s.message=t,s.xid=e.info.xid,localStorage.setItem(r,JSON.stringify(s))}}catch(e){this._debug(e)}e.anchor.setAttribute("data-written","true")})}_promiseTimeout(e,t){let i=new Promise((t,i)=>{let r=setTimeout(()=>{clearTimeout(r),i("Timed out in "+e+"ms.")},e)});return Promise.race([t,i])}_cleanupXid(e,t){if(null==e)return"";let i,r;return null==t&&(t=""),this._isEmpty(e)||(i=e.indexOf("|xid:fr"),r="|xid:fr".length,-1===i&&(i=e.indexOf("xid:fr"),r="xid:fr".length),-1!==i&&(e=this._insertSubstringToString(e,t,i,i+r+16))),e}_appendUUID(){let e={amazon:this._asBoolean(this._settings.detection_rules.amazon_no_append)};const t=Date.now();for(let r=0;r<this._links.length;r++){let s=this._links[r];if(s.anchor.hasAttribute("data-xid")){var i=s.anchor.getAttribute("data-xid").replace("fr","").slice(0,-3);if(!(parseInt(i)+86400<t))continue;s.anchor.removeAttribute("data-xid")}let n=s.info.url,a=s.network,o=this._generateUUID();1==s.anchor.hasAttribute("data-prepend-xid")&&(o=s.anchor.getAttribute("data-prepend-xid")),1==s.anchor.hasAttribute("data-written")&&s.anchor.removeAttribute("data-written"),this._xids[o]="",s.info.xid=o,null!=e[a]&&!1!==e[a]||1==s.anchor.hasAttribute("data-prepend-xid")&&1==s.anchor.hasAttribute("data-affiliation-url")||(s.info.embedded&&null!=s.info.wrapping_url&&-1==s.info.wrapping_url.indexOf("shop-links.co")&&(s.info.wrapping_url=this._appendExtraParam(s.info.wrapping_net,s.info.wrapping_url,"xid",o,!1)),s.info.url=this._appendExtraParam(a,n,"xid",o,!1)),s.anchor.setAttribute("data-xid",o),this._new_window&&0==s.anchor.hasAttribute("target")&&s.anchor.setAttribute("target","_blank"),null!=window.trxdebug&&s.anchor.setAttribute("data-network",a)}}_appendReferrer(e){if(this._asBoolean(e.enabled)){let t=e.attr_name,i=this._asBoolean(e.new_query_param),r=document.referrer;void 0!==trx.referrer&&(r=trx.referrer),"/"===r.charAt(r.length-1)&&(r=r.substring(0,r.length-1)),this._paramsBuffer[t]=r,this._paramsBuffer.urls.referrer=r,this._paramsBuffer.urls.is_trx_referrer=void 0!==trx.referrer}}_appendTiming(e){if(this._asBoolean(e.enabled)){let t=this._asBoolean(e.new_query_param),i;e.t_load&&(this._paramsBuffer.t_loaded=this._loadTime,this._paramsBuffer.timing.t_loaded=this._loadTime)}}_appendAttributes(e){if(this._asBoolean(e.enabled)&&!this._isEmpty(e.attributes)>0){let t;this._parseQuery(e.attributes).forEach((e,t,i)=>{for(let i=0;i<this._links.length;i++){let r=this._links[i];this._paramsBuffer[t]=e,this._paramsBuffer.attr_append[t]=e}})}}_attributesForwarding(e,t){if(this._asBoolean(e.enabled)&&e.attributes instanceof Array&&e.attributes.length>0){!0===t&&(this._paramsBuffer.attr_forwarding={});let r=location.search;if(void 0!==trx.source&&(r="?"+trx.source.replace(/(\S*)\?/,"")),void 0===e.attributes.includes.cntt&&e.attributes.push("cntt"),!this._isEmpty(r)&&r.length>1){let t;this._parseQuery(r.substring(1)).forEach((t,i,r)=>{e.attributes.includes(i)&&(this._paramsBuffer.attr_forwarding[i]=t)})}try{var i;if(sessionStorage)if(null!=this._paramsBuffer.attr_forwarding&&"null"!=this._paramsBuffer.attr_forwarding||(this._paramsBuffer.attr_forwarding={}),0==Object.keys(this._paramsBuffer.attr_forwarding).length)try{this._paramsBuffer.attr_forwarding=JSON.parse(sessionStorage.getItem("fr_attr_forwarding")),null!=this._paramsBuffer.attr_forwarding&&"null"!=this._paramsBuffer.attr_forwarding||(this._paramsBuffer.attr_forwarding={})}catch(e){this._debug(e),this._paramsBuffer.attr_forwarding={}}else try{sessionStorage.setItem("fr_attr_forwarding",JSON.stringify(this._paramsBuffer.attr_forwarding))}catch(e){this._debug(e)}}catch(e){this._debug(e)}}}_prepareEventTracking(e){if(this._asBoolean(e.enabled)){if(this._isEmpty(e.analytics_code)||0!==e.analytics_code.indexOf("UA-")||"undefined"==typeof ga){if(this._isEmpty(e.analytics_code)||"undefined"==typeof s||"function"!=typeof s.tl)return;this.trackerObj=new trx.AdobeTracker(e.analytics_code)}else this.trackerObj=new trx.GATracker(e.analytics_code);if(this._asBoolean(e.pageview)&&this.trackerObj.trackPageView(),this._asBoolean(e.clicks))for(let t=0;t<this._links.length;t++){let i=this._links[t],r=i.anchor,s=i.info.xid;r.addEventListener("click",()=>{let t=this._getAnchorLabel(r,50)+" ["+r.href+"]";this.trackerObj.trackEvent("magic-links","click",t,"1",{xid:s,anchor:r,props_map:e.props_map,props_map_custom:e.props_map_custom,data:this.paramsBuffer})}),this._markLink("feature","track_events",r)}}}_autoOptimizeLinks(e){this._asBoolean(e.enabled)}_preparePreview(e){if(this._asBoolean(e.enabled)){if(e.show_icon)for(let e=0;e<this._links.length;e++){let t,i=this._links[e].anchor,r=document.createElement("span");r.style.cursor="pointer",r.innerHTML="&nearr;",r.addEventListener("click",trx.MagicLinks.renderLinkPreview.bind(this,i.getAttribute("data-ml-id"))),i.insertAdjacentElement("afterend",r),this._markLink("feature","preview",i)}e.show_metadata,e.show_coupons}}_prepareShortExtraParam(e){this._asBoolean(e.enabled)}_prepareCustomMetadata(){let e={autorun:1,report:1,version:1,simulator:1,"property-id":1,"customer-id":1};if(null!=this._scriptEm&&void 0!==this._scriptEm.attributes)for(var t=0;t<this._scriptEm.attributes.length;t++){var i=this._scriptEm.attributes[t];if(-1!==i.name.indexOf("data-")){let t=i.name.replace("data-","");if(e[t])continue;this._debug(t+" = "+i.value),this._paramsBuffer.custom_meta[t]=i.value}}}_prepareMetadata(e){if(!this._isEmpty(e.selectors)){let t,i,r,s=e.selectors.split("\n");for(let e=0;e<s.length;e++)try{let n=s[e];if(this._isEmpty(n))this._log("Ignoring empty line in metadata settings.");else{let e=n.split("|");if(e.length>1){if(t=e[0].trim(),0===(i=e[1].trim()).length)continue;if(0===(i=e.slice(1).join().trim()).indexOf("js::")){let e=i.replace("js::","").trim();null==(r=trx.MagicLinks._getObjectByPath(e))&&("function"==typeof trx.get[t]?r=trx.get[t]():this._log("Missing function trx.get."+t))}else if(0===i.indexOf("ck::")){let e=i.replace("ck::","").trim();this._isEmpty(e)?this._log("Invalid metadata cookie line. Cookie name is missing"):r=this._getCookie(e)}else if(0===i.indexOf("ls::")){let e=i.replace("ls::","").trim();try{if("undefined"!=typeof Storage){let t=void 0;t=window.localStorage.getItem(e),this._isEmpty(t)?this._log("Invalid metadata localStorage line. Storage name is missing"):r=t}}catch(e){this._debug(e)}}else if("function"==typeof document.evaluate){let e;r=document.evaluate(i,document,null,XPathResult.STRING_TYPE,null).stringValue}this._isEmpty(r)||((r instanceof Array||"number"==typeof r)&&(r=r.toString()),this._paramsBuffer[t]=r.trim(),this._paramsBuffer.metadata[t]=r.trim())}else this._log("Invalid metadata line. Line must have name and Xpath value in this format: name | xpath ")}}catch(e){this._log(e)}}}_getCookie(e){try{let t=e+"=",i,r=decodeURIComponent(document.cookie).split(";");for(let e=0;e<r.length;e++){let i=r[e];for(;" "===i.charAt(0);)i=i.substring(1);if(0===i.indexOf(t))return i.substring(t.length,i.length)}}catch(e){this._debug(e)}return""}_logPageTrace(){try{if(sessionStorage){let i=this._needToClearTraces();var e=[];try{e=JSON.parse(sessionStorage.getItem("fr_referrer_trace"))}catch(t){this._debug(t),e=[]}(null==e||i&&0==trx.global_trace.length&&1!==e.length)&&(e=trx.global_trace);let r=null,s;try{r=sessionStorage.getItem("fr_last_loaded_page")}catch(e){this._debug(e)}if(null!=r&&r===location.href)return trx.global_trace=e,void(this._paramsBuffer.page_trace=e);try{sessionStorage.setItem("fr_last_loaded_page",location.href)}catch(e){this._debug(e)}if(e.length>=10)s={source:"..."};else{var t=location.href;void 0!==trx.source&&(t=trx.source),s={source:t,referrer:document.referrer,attr_forwarding:this._paramsBuffer.attr_forwarding}}e.push(s);try{sessionStorage.setItem("fr_referrer_trace",JSON.stringify(e))}catch(e){this._debug(e)}this._paramsBuffer.page_trace=e}}catch(e){this._debug("Error when recording referrer trace. Details: ",e)}}_needToClearTraces(){if(this._isEmpty(document.referrer))return!0;let e=!1,t="",i=document.referrer.split("/");return!Array.isArray(i)||(""!==(t=i[2])&&t===location.hostname||(e=!0),e)}_disbaleLinks(){if(void 0!==this._settings.disable_rules&&this._asBoolean(this._settings.disable_rules.enabled)&&void 0!==this._settings.disable_rules.networks){var e=[];for(let e=0;e<this._links.length;e++){let t=this._links[e],i=t.info.url,r=t.network;if(this._asBoolean(this._settings.disable_rules.networks[r])&&this._disbaleLink(t),void 0!==this._settings.disable_rules.custom)for(let e of this._settings.disable_rules.custom)switch(e.type){case"url":if(!this._isEmpty(i)&&this._isAbsolute(i)&&!this._isExcludedUrl(i))try{let r;new RegExp(e.pattern).test(i)&&this._disbaleLink(t)}catch(e){this._debug(e)}break}}}}_disbaleLink(e){e.info.disable=!0;let t=e.anchor.href;e.anchor.setAttribute("data-orig-url",t),e.anchor.href="javascript:void(0)"}_detectLinks(){if(this._asBoolean(this._settings.detection_rules.auto)&&(this._asBoolean(this._settings.detection_rules.auto_networks.dynamic)&&this._markDynamicDomainLinks(),this._autoDetectByUrl()),void 0!==this._settings.detection_rules.custom&&this._settings.detection_rules.custom.length>0){this._autoDetectCustomRules(this._settings.detection_rules.custom);for(let e of this._settings.detection_rules.custom)switch(e.type){case"element":this._detectByElementSelector(e);break}}for(let e=0;e<this._links.length;e++){let t=this._links[e];t.anchor.setAttribute("data-ml-id",e),t.anchor.setAttribute("data-ml","true")}}_autoDetectCustomRules(){let e,t;for(let e of this._settings.detection_rules.custom)if(e.pattern)try{let t=new RegExp(e.pattern);e.regexp=t}catch(e){this._debug(e)}for(let s=0;s<document.links.length;s++){let n=document.links[s];if(!0===trx.magicLinksSimulator||!n.hasAttribute("data-xid")){e=n.href;var i=this._getAbsoluteOffsetFromBody(n);if(void 0===this._links_unique[i.top+"_"+i.left+"_"+e]){var r=!1;for(let e of this._settings.detection_rules.custom)if("url"==e.type&&(r=this._detecLinktByUrlToken(n,e)))break;if(!this._isEmpty(e)&&this._isAbsolute(e)&&!this._isExcludedUrl(e)&&1==r){let r={inxStart:0,inxEnd:0,embedded:!1,dynamic:!1,dynamicType:null,url:e};!1===(t=this._detectKnownAffiliateLink(e,r))&&(t="other"),this._checkEmbeddedLink(e,r),r.network=t,this._links.push({network:t,anchor:n,info:r}),this._links_unique[i.top+"_"+i.left+"_"+e]=n,n.hasAttribute("data-orig-url")||n.setAttribute("data-orig-url",e)}}}}}_detecLinktByUrlToken(e,t){return!!t.regexp&&t.regexp.test(e)}_autoDetectByUrl(){let e,t,i=this._settings.detection_rules.auto_networks;for(let n=0;n<document.links.length;n++){let a=document.links[n];if(!0===trx.magicLinksSimulator||!a.hasAttribute("data-xid")){e=a.href;var r=this._getAbsoluteOffsetFromBody(a);if(void 0===this._links_unique[r.top+"_"+r.left+"_"+e]&&!this._isEmpty(e)&&this._isAbsolute(e)&&!this._isExcludedUrl(e)){let n={inxStart:0,inxEnd:0,embedded:!1,dynamic:!1,dynamicType:null,url:"",network:""};if(t=this._detectKnownAffiliateLink(e,n),this._checkEmbeddedLink(e,n),!1!==t&&this._asBoolean(i[t])||a.hasAttribute("data-prepend-xid")){if(a.hasAttribute("data-prepend-xid")&&this._debug("found prepended xid"),n.network=t,"sas"==t&&-1!==e.search(/(r\.cfm\?b=999&)|(r.cfm%3Fb%3D999%26)/)){this._log("found wrong SAS url.");var s=e;void 0!==n.wrapping_url&&(s=n.url),s=(s=s.replace("r.cfm?b=999&","r.cfm?b=999999&")).replace("r.cfm%3Fb%3D999%26","r.cfm%3Fb%3D999999%26"),n.url=s,a.setAttribute("data-orig-url",e)}this._links.push({network:t,anchor:a,info:n}),this._links_unique[r.top+"_"+r.left+"_"+e]=a,a.hasAttribute("data-orig-url")||a.setAttribute("data-orig-url",e)}else!1===t&&this._asBoolean(i.dynamic)&&"true"===a.getAttribute("data-ml-dynamic")&&(n.inxStart=0,n.inxEnd=0,n.embedded=!1,n.dynamic=!0,n.dynamicType=a.getAttribute("data-ml-dynamic-type"),n.url="",n.network=a.getAttribute("data-ml-dynamic-type"),this._links.push({network:t,anchor:a,info:n}),this._links_unique[r.top+"_"+r.left+"_"+e]=a,a.hasAttribute("data-orig-url")||a.setAttribute("data-orig-url",e))}}}}_getAbsoluteOffsetFromBody(e){for(var t=0,i=0;e&&!isNaN(e.offsetLeft)&&!isNaN(e.offsetTop);)t+=e.offsetLeft-e.scrollLeft+e.clientLeft,i+=e.offsetTop-e.scrollTop+e.clientTop,e=e.offsetParent;return{top:i,left:t}}_detectByElementSelector(e){let t,i,r;document.querySelectorAll(e.selector).forEach(r=>{if(!0===trx.magicLinksSimulator||!r.hasAttribute("data-xid"))if("A"===r.nodeName&&void 0===e.selector_attribute){t=r.href;var s=this._getAbsoluteOffsetFromBody(r);if(void 0!==this._links_unique[s.top+"_"+s.left+"_"+t])return;if(!this._isEmpty(t)&&this._isAbsolute(t)&&!this._isExcludedUrl(t))try{let n;if(new RegExp(e.pattern).test(t)){let e={inxStart:0,inxEnd:0,embedded:!1,dynamic:!1,dynamicType:null,url:t};!1===(i=this._detectKnownAffiliateLink(t,e))&&(i="other"),this._checkEmbeddedLink(t,e),e.network=i,this._links.push({network:i,anchor:r,info:e}),this._links_unique[s.top+"_"+s.left+"_"+t]=r,r.hasAttribute("data-orig-url")||r.setAttribute("data-orig-url",t)}}catch(e){this._debug(e)}}else if(r.nodeName.toLowerCase()===e.selector_element){t=void 0,void 0!==r[e.selector_attribute]&&(t=r[e.selector_attribute]),r.hasAttribute(e.selector_attribute)&&(t=r.getAttribute(e.selector_attribute));var s=this._getAbsoluteOffsetFromBody(r);if(void 0!==this._links_unique[s.top+"_"+s.left+"_"+t])return;if(!this._isEmpty(t)&&this._isAbsolute(t)&&!this._isExcludedUrl(t))try{let n;if(new RegExp(e.pattern).test(t)){let n={inxStart:0,inxEnd:0,embedded:!1,dynamic:!1,dynamicType:null,url:t};!1===(i=this._detectKnownAffiliateLink(t,n))&&(i="other"),this._checkEmbeddedLink(t,n),n.selector_element=e.selector_element,n.selector_attribute=e.selector_attribute,n.network=i,this._links.push({network:i,anchor:r,info:n}),this._links_unique[s.top+"_"+s.left+"_"+t]=r,r.hasAttribute("data-orig-url")||r.setAttribute("data-orig-url",t)}}catch(e){this._debug(e)}}})}_detectKnownAffiliateLink(e,t){let i,r,s={};void 0!==this._serverSettings.impact_domains&&(s=this._serverSettings.impact_domains);var n=e.match(/^https?\:\/\/([^\/?#]+)(?:[\/?#]|$)/i),a=n&&n[1];if(null!==a&&1!==s[a]){const e=/(([a-z\-0-9]+)(?:\.com|\.fr|\.co.uk|\.io|\.net|\.com.au|\.co|\.tv|\.market))/g;null!==(n=a.match(e))&&1==n.length&&(a=n[0])}if(-1!==e.indexOf("/dp/")&&e.includes("tag=")&&(r=-1!==e.indexOf("amazon."))||-1!==e.indexOf("/gp/")&&e.includes("tag=")&&(r=-1!==e.indexOf("amazon."))||(r=-1!=e.indexOf("/amzn."))||(r=-1!=e.indexOf("/www.amzn."))||(r=-1!=e.indexOf(".amazon-adsystem.com")))i="amazon";else if(-1!==(r=e.indexOf("linksynergy")))i="ls";else if(-1!==(r=e.indexOf("anrdoezrs.net"))||-1!==(r=e.indexOf("jdoqocy.com"))||-1!==(r=e.indexOf("tqlkg.com"))||-1!==(r=e.indexOf("tkqlhce.com"))||-1!==(r=e.indexOf("dpbolvw.net"))||-1!==(r=e.indexOf("jqoqocy.com"))||-1!==(r=e.indexOf("kqzfj.com"))||-1!==(r=e.indexOf("kqzyfj.com"))||-1!==(r=e.indexOf("ftjcfx.com"))||-1!==(r=e.indexOf("lduhtrp.net"))||-1!==(r=e.indexOf("qksrv.net")))i="cj";else if(-1!==(r=e.indexOf("shareasale.com")))i="sas";else if(-1!==(r=e.indexOf("awin1.com")))i="awin";else if(-1!==(r=e.indexOf("pepperjamnetwork.com"))||-1!==(r=e.indexOf("pjtra.com/t/"))||-1!==(r=e.indexOf("gopjn.com/t/"))||-1!==(r=e.indexOf("pjatr.com/t/"))||-1!==(r=e.indexOf("pntra.com/t/"))||-1!==(r=e.indexOf("pntrs.com/t/"))||-1!==(r=e.indexOf("pntrac.com/t/")))i="pj";else if(-1!==(r=e.indexOf("track.webgains.com")))i="wg";else if(-1!==(r=e.indexOf("prf.hn/click")))i="pt";else if(-1!==(r=e.indexOf("tradedoubler.com/click?"))||-1!==(r=e.indexOf("pf.tradedoubler.com/pf/")))i="td";else if(-1!==(r=e.search(/\/c\/(\d+)\/(\d+)\//))||-1!==(r=e.search(/%2Fc%2F(\d+)%2F(\d+)%2F(\d+)%/))||1==s[a])i="ir";else if(-1!==(r=e.indexOf("go.redirectingat.com"))||-1!==e.indexOf("go.skimresources.com")||-1!==e.indexOf("fave.co"))i="sl";else if(-1!==(r=e.indexOf("redirect.viglink.com")))i="vg";else if(-1!==(r=e.indexOf("avantlink.com/click")))i="al";else if(-1!==(r=e.indexOf("track.adtraction.com"))||-1!==(r=e.indexOf("adtr.co"))||-1!==(r=e.search(/\/t\/t\/\?a=(\d+)/))||-1!==(r=e.search(/\/t\/t\?a=(\d+)/)))i="at";else if(-1!==(r=e.indexOf("tc.tradetracker.net"))||-1!==(r=e.search(/(\?|\&)tt=(\d+)_(\d+)_(\d+)(_[\w-]+)?/)))i="tt";else if(-1!==(r=e.indexOf("/aff_c"))&&-1!==e.search(/aff_id=(\d+)/))i="ho";else if(r=-1!==e.indexOf("c.trackmytarget.com"))i="tc";else if(r=-1!==e.indexOf("buy.geni.us/Proxy.ashx"))i="ge";else if((r=-1!==e.indexOf("partner.bol.com/click/click"))||(r=-1!==e.indexOf("tracking.bol.com/click/click")))i="bol";else if(r=-1!==e.indexOf("track.wg-aff.com/click"))i="afs";else if(r=-1!==e.indexOf("oc.brcclx.com/t/?"))i="rv";else if(r=-1!==e.search(/(wayfair\.com[\S]+refid=)/))i="wyf";else if((r=-1!==e.search(/(ndt5\.net\/c\/)/))||(r=-1!==e.search(/(ds1\.nl\/c\/)/))||(r=-1!==e.search(/(lt45\.net\/c\/)/))||(r=-1!==e.search(/(fr135\.net\/c\/)/))||(r=-1!==e.search(/(dt51\.net\/c\/)/))||(r=-1!==e.search(/(at19\.net\/c\/)/))||(r=-1!==e.search(/(jf79\.net\/c\/)/)))i="dc";else if(r=-1!==e.search(/(ostlon\.com\/4LS8T4J\/9LLP2M\/)|(hiasor\.com\/4LS8T4J\/ZCJM85\/)|(goplay4\.com\/4LS8T4J\/HWPZ42Z\/)|(trck1t\.com\/4LS8T4J\/J5ZP3HL\/)/))i="ef";else if(r=-1!==e.search(/((ebay\.)(?=.*\bcampid=[\d+])(?=.*\bmkcid=1\b)(?=.*\bmkrid=[\d+]*\b)[\S]*)|((ebay\.)(?=.*\bcampid=[\d+])(?=.*\bmpre=[\d+]*\b)(?=.*\bpub=[\d+]*\b)[\S]*)|((ebay\.).[\S]*(mkcid%3D)[\S]*(mkrid%3D[0-9\-]*)[\S]*(%26campid%3D[0-9]*)[\S]*)/))i="ebay";else if(r=-1!==e.search(/((spindlemattress|worldwidecyclery|thegravitycartel|verdebikes|gaggiadirect|cobocbd|leafremedys)\.com[\S]*[\&|\?]aff=[\d]+)|(lumen\.me[\S]*[\&|\?]fid=[\d]+)/))i="afy";else if(r=-1!==e.search(/(\?|\&)(rfsn=([0-9]{1,})\.([a-z0-9]{3,}))/))i="rfs";else if(r=-1!==e.search(/(cmtcr\.com\/clk\.trk|qwxyq\.com\/clk\.trk)/))i="ct";else if(r=-1!==e.search(/(track\.flexlinkspro\.com|track\.flexlinks\.com)/))i="fo";else if(r=-1!==e.search(/(stackedbrands\.com|getrxd\.com|transparentlabs\.com|roguefitness\.com|leanbeanofficial\.com|realketones\.com|amplemeal\.com)|([\?|\&|\#]a_aid=[a-zA-Z0-9]+)/))i="pap";else if(r=-1!==e.search(/(bhphotovideo\.com\/c\/product[\S]*\/BI\/[\d]*[\S]*\/KBID\/[\d]*)/))i="bhp";else if(r=-1!==e.search(/(track.effiliation.com\/)[\S]*(id_compteur=[1-9]+)/))i="eff";else if(r=-1!==e.search(/(financeads\.net\/tc\.php)/))i="fnc";else{if(!(r=-1!==e.search(/(\.digidip\.net\/visit[\S]*(url=))|(\.digidip\.net%2Fvisit[\S]*(url%3D))/)))return!1;i="dd"}return t.inxNext=r,i}_isCJ(e){return-1!==e.indexOf("anrdoezrs.net")||-1!==e.indexOf("jdoqocy.com")||-1!==e.indexOf("tqlkg.com")||-1!==e.indexOf("tkqlhce.com")||-1!==e.indexOf("dpbolvw.net")||-1!==e.indexOf("jqoqocy.com")||-1!==e.indexOf("kqzfj.com")||-1!==e.indexOf("kqzyfj.com")||-1!==e.indexOf("ftjcfx.com")||-1!==e.indexOf("lduhtrp.net")||-1!==e.indexOf("qksrv.net")}_findAsin(e){let t=null;const i=/(?:[/dp/]|$)([A-Z0-9]{10})(?:[\/])/g,r=e.match(i);return null!==r&&r.length>0&&(t=r[0].replace("/","").replace("/","")),t}_checkEmbeddedLink(e,t){let i=t.inxNext,r=e.lastIndexOf("=",i);if(-1!==r&&r<i){t.inxStart=r+1;let s=e.indexOf("&",i);-1===s&&(s=e.length),t.inxEnd=s,t.embedded=!0,t.url=decodeURIComponent(e.substring(t.inxStart,t.inxEnd));let n=e.substring(0,t.inxStart),a=e.substring(t.inxEnd);t.wrapping_url=n+this._embedUrlToken+a,-1!==e.indexOf("go.redirectingat.com")||-1!==e.indexOf("go.skimresources.com")?t.wrapping_net="sl":-1!==e.indexOf("redirect.viglink.com")?t.wrapping_net="vg":-1!==e.indexOf("(.digidip.net%2Fvisit[S]*(url%3D))")&&(t.wrapping_net="dd")}else t.inxStart=0,t.inxEnd=e.length,t.embedded=!1,t.url=e}_markDynamicDomainLinks(){let e,t;var i=void 0;if("undefined"!=typeof skimlinksInitialized&&(i=!0),"undefined"!=typeof __SKIM_JS_GLOBAL__&&"function"==typeof __SKIM_JS_GLOBAL__.getDebugInfo)e="sl",t=__SKIM_JS_GLOBAL__.getDebugInfo().runTimeInfo.aff_domains;else if(void 0!==i)e="sl";else{if("undefined"==typeof vglnk||"function"!=typeof vglnk.opt)return;e="vg",t=vglnk.opt("commercial_domains")}if(null!=t){for(let i=0;i<document.links.length;i++)try{let r=document.links[i],s=r.hostname;!0===t[s=s.replace("www.","")]&&(r.setAttribute("data-ml-dynamic","true"),r.setAttribute("data-ml-dynamic-type",e))}catch(e){this._log(e)}try{this._debug("FR find dynamic domains: "+JSON.stringify(t))}catch(e){}}else if(void 0!==i){skimlinks_exclude;var r=[];"undefined"!=typeof skimlinksInitialized&&(r=skimlinks_exclude);let i=document.querySelectorAll("a[data-skimlinks-tracking]"),a="("+r.join("|").replace("*","")+")",o=new RegExp(a),l={};for(let t in i)if(void 0!==i[t].href){if(o.test(i[t].href))continue;var s=i[t].href.match(/^https?\:\/\/([^\/?#]+)(?:[\/?#]|$)/i),n=(s&&s[1]).replace("www.","");void 0!==n&&void 0==l[n]&&(l[n]=1);try{i[t].setAttribute("data-ml-dynamic","true"),i[t].setAttribute("data-ml-dynamic-type",e)}catch(e){this._log(e)}}void 0!==l&&(t=Object.keys(l))}else this._debug("FR didn't find dynamic domains")}_isExcludedUrl(e){let t=this._exclude_urls_regex;for(let i=0;i<t.length;i++)if(t[i].test(e))return!0;return!1}_prepareSettings(){this._settings=trx.MagicLinks.prepareDefaultSettings({}),Object.keys(this.serverSettings).length>0&&(this._settings=this._extendForte(this._settings,this.serverSettings)),Object.keys(this.onPageSettings).length>0&&(this._settings=this._extendForte(this._settings,this.onPageSettings))}_collectClickTimeParams(){let e=this._settings.features.append_timing;if(this._asBoolean(e.enabled)){let t=e.t_clicked,i=e.t_toclick,r=Date.now();t&&(this._paramsBuffer.t_clicked=r,this._paramsBuffer.timing.t_clicked=r),i&&(this._paramsBuffer.t_toclick=r-this._loadTime,this._paramsBuffer.timing.t_toclick=r-this._loadTime)}}_writeDataToEventsService(e,t,i){let r;try{r=JSON.parse(JSON.stringify(this._paramsBuffer))}catch(e){this._log(e),r=this._paramsBuffer}r.uuid=e.info.xid;var s=e.info.xid;if(r.link_replaced=!1,e.anchor.hasAttribute("data-spot-rid")){let t=e.anchor.getAttribute("data-spot-rid"),i=e.anchor.getAttribute("data-orig-url"),n=e.anchor.getAttribute("data-spot-replaced");s=t,r.uuid=t,r.original_xid=e.info.xid,r.link_replaced=!0,r.orig_url=i,r.link_replace_to=n}if(void 0===s&&e.anchor.hasAttribute("data-xid")&&(s=e.anchor.getAttribute("data-xid")),e.anchor.hasAttribute("data-orig-url")&&(r.anchor_orig=e.anchor.getAttribute("data-orig-url")),r.client_time=(new Date).toISOString(),r.anchor_id=this._emptyIfNull(e.anchor.id),r.anchor_href=e.anchor.href,r.anchor_label=e.anchor.innerText,r.page_title=document.title,r.spot_id="",r.network=e.info.network,null!=t&&(r.event_type=t),e.anchor.hasAttribute("data-affiliation-url")&&(r.anchor_href=e.anchor.getAttribute("data-affiliation-url"),r.network=this._detectKnownAffiliateLink(r.anchor_href,{})),e.anchor.hasAttribute("data-vars-link-id")&&(void 0===r.metadata&&(r.metadata={}),r.metadata.linkid=e.anchor.getAttribute("data-vars-link-id")),void 0!==e.anchor.attributes)for(var n=e.anchor.attributes,a="",o=n.length-1;o>=0;o--)(n[o].name.indexOf("trx-vars-")>-1||n[o].name.indexOf("affluent-details-")>-1)&&(void 0==r.link_meta&&(r.link_meta={}),(a=n[o].value.replace(/[^a-z0-9A-Z \-\_]/gi,"")).length>256&&(a=a.slice(0,256)),r.link_meta[n[o].name.replace("trx-vars-","").replace("affluent-details-","")]=a);if(null!=i&&"object"==typeof i)for(let e in i)i.hasOwnProperty(e)&&0===e.indexOf("custom_")&&(r[e]=i[e]);let l=this._envSettings.events_recording_api+"/write",d={env:this._envSettings.events_recording_env,id:s,app_key:this._envSettings.app_key,property_id:r.property_id,customer_id:r.customer_id,cidp1:r.cidp1,cidp2:r.cidp2,event_type:r.event_type,network:r.network,data:encodeURIComponent(JSON.stringify(r))},c=JSON.stringify(d),h=JSON.parse(c);h.data=r;let u=JSON.stringify(h),_=r.uuid;delete r.uuid,delete r.client_time,delete r.anchor_href,delete r.anchor_label,delete r.page_title,delete r.spot_id;try{if("undefined"!=typeof Storage){var f="fr_click_"+_;localStorage.setItem(f,c)}}catch(e){this._debug(e)}if(void 0!==this._envSettings.events_recording_api2){let e=this._envSettings.events_recording_api2+"/write";var g={method:"POST",mode:"cors",cache:"no-cache",credentials:"same-origin",headers:{"Content-Type":"application/json"},redirect:"follow",referrer:"*client",body:c};this._iframed&&(g.referrer=location.href),fetch(e,g).then(e=>{if(e.ok){let e="Write to events-recording service. Body:\n"+u;return this._isSimulator&&this._log(e),void this._debug(e)}this._log("Fail to write event data. HTTP error, status = "+e.status);try{if("undefined"!=typeof Storage){var t=Math.round((new Date).getTime()/1e3);f="fr_log_"+t}}catch(e){this._debug(e)}}).then(e=>{e&&e.message&&this._log(e.message)}).catch(e=>{this._log(e)})}let m={method:"POST",mode:"cors",cache:"no-cache",credentials:"same-origin",headers:{"Content-Type":"application/json"},redirect:"follow",referrer:"*client",body:c};if(this._iframed&&(m.referrer=location.href),"AMP"==t){var p=l.match(/^https?\:\/\/([^\/?#]+)(?:[\/?#]|$)/i),b,b,k;if(void 0!==(b=(p&&p[1]).replace("www.","")))(b=b.split(".").slice(-2).join("."))==location.hostname.split(".").slice(-2).join(".")&&(this._debug("same domain"),m.credentials=m.headers=m.mode=void 0)}if(navigator.sendBeacon&&this._use_beacon){try{let e=navigator.sendBeacon(l,c)}catch(e){console.log(e)}if(this._debug("sendBeacon: URL = "+l+"; status = "+status),1==status)try{localStorage.removeItem(f)}catch(e){this._debug(e)}return status}return fetch(l,m).then(t=>{if(t.ok){let e="Write to events-recording service. Body:\n"+u;if(this._isSimulator&&this._log(e),200==t.status)try{"undefined"!=typeof Storage&&localStorage.removeItem(f)}catch(e){this._debug(e)}return this._debug(e),t.json()}this._log("Fail to write event data. HTTP error, status = "+t.status);try{if("undefined"!=typeof Storage){var i=Math.round((new Date).getTime()/1e3);f="fr_log_"+i;var s=this._getLogInfomration(r);s.message="Fail to write event data. HTTP error, status = "+t.status,s.xid=e.info.xid,localStorage.setItem(f,JSON.stringify(s))}}catch(e){this._debug(e)}}).then(t=>{if(t&&t.message){this._log(t.message);try{if("undefined"!=typeof Storage){var i=Math.round((new Date).getTime()/1e3);f="fr_log_"+i;var s=this._getLogInfomration(r);s.message=t.message,s.xid=e.info.xid,localStorage.setItem(f,JSON.stringify(s))}}catch(e){this._debug(e)}}}).catch(t=>{this._log(t);try{if("undefined"!=typeof Storage){var i=Math.round((new Date).getTime()/1e3);f="fr_log_"+i;var s=this._getLogInfomration(r);s.message=t.message,s.xid=e.info.xid,localStorage.setItem(f,JSON.stringify(s))}}catch(e){this._debug(e)}})}_getLogInfomration(e){return e.env=this._envSettings.events_recording_env,e.app_key=this._envSettings.app_key,e.property_id=this._propertyId,e.customer_id=this._customerId,e.loginfo={nAgt:navigator.userAgent,screen:screen.width+"*"+screen.height},e}_log(e){console.log(this._logPrefix+e)}_error(e,t){console.error(this._logPrefix+e),null!=t&&console.error(t);try{if("undefined"!=typeof Storage){var i,r="fr_log_"+Math.round((new Date).getTime()/1e3),s={},n=this._getLogInfomration(s);n.message=this._logPrefix+e,localStorage.setItem(r,JSON.stringify(n))}}catch(e){this._debug(e)}}_debug(e){null!=window.trxdebug&&console.log(this._logPrefix+e)}_prepareExcludeRegExp(){this._exclude_urls_regex=[];let e=this._settings.detection_rules.exclude_urls;if(e.length>0)for(let t=0;t<e.length;t++)try{this._exclude_urls_regex.push(new RegExp(e[t],"i"))}catch(e){this._debug(e)}}_extendForte(e,t){if(null==e||null==t)throw"Null object provided to extendForte!";const i={};let r;for(r in e)if(e.hasOwnProperty(r)){let s=e[r];const n=t[r];null!=s&&null!=n?s instanceof Array?i[r]=n:i[r]="object"==typeof s?this._extendForte(s,n):n:i[r]=null==s?n:null==n?s:null}for(r in t)t.hasOwnProperty(r)&&(r in e&&null!=e[r]||(i[r]=t[r]));return i}_postReport(){this._report={links:[]};for(let e=0;e<this._links.length;e++){let t=this._links[e].anchor,i=this._getAnchorLabel(t,100);this._report.links.push({network:this._links[e].network,url:t.href,label:i})}window.postMessage({type:"MSG_FROM_MAGIC_LINKS",action:"report",report:JSON.stringify(this._report)},"*")}_markLink(e,t,i){let r=i.getAttribute("data-"+e);r+=","+t,i.setAttribute("data-"+e,r)}_appendExtraParam(e,t,i,r,s){let n=null,a=!1;var o=":";let l=!1;if(s)n=null;else switch(e){case"cj":n="sid",a=!0,o="-";break;case"ls":n="u1";break;case"sas":n="afftrack";break;case"awin":n="clickref";break;case"pj":n="sid";break;case"sl":n="xcust";break;case"vg":n="cuid";break;case"ir":n="subId3";break;case"wg":n="clickref";break;case"td":n="epi(",a=!0;break;case"pt":n="pubref:",a=!0;break;case"amazon":n="ascsubtag";break;case"al":n="ctc";break;case"at":n="epi",o="%3A";break;case"tt":-1!==t.indexOf("tc.tradetracker.net")?n="r":(n="tt",o="-");break;case"ho":n="aff_sub3",o="%3A";break;case"tc":n="ref3";break;case"bol":n="subid",o="-","xid"==i&&(i="fr-xid");break;case"afs":n="sub5",o="-";break;case"dc":n="ws3";break;case"ef":n="sub3";break;case"ebay":n="customid",-1===t.indexOf("https%3A%2F%2Fwww.ebay.com")&&-1===t.indexOf("https%3A%2F%2Febay.com")||(l=!0);break;case"rfs":n="subid";break;case"ct":n="sid";break;case"fo":n="fobs";break;case"pap":n="data1";break;case"bhp":n="SID",a=!0,o="-";break;case"eff":n="effi_id";break;case"fnc":n="subid";break;case"dd":n="ref",-1!==t.search(/\.digidip\.net%2Fvisit[\S]*(url%3D)/)&&(l=!0);break;case"afy":n="xid";break;case"rv":n="tid",o="-","xid"==i&&(i="fr-xid");break;default:n=null}return this._appendNameValueToUrl(t,i,r,n,a,e,o,l)}_appendNameValueToUrl(e,t,i,r,s,n,a,o){let l,d,c,h,u,_;if(void 0===o&&(o=!1),i=encodeURIComponent(i),void 0===a&&(a=":"),null!=r){if(u=t+a+i,s)return-1!==(l=e.indexOf(r+"/"))?(l+=(r+"/").length,-1===(d=e.indexOf("/",l))&&(d=e.length),(_=e.substring(l,d)).length>0&&(u=this._getDelimiter(e,n)+u),this._insertToString(e,u,d)):"pt"===n?this._appendNameValueToUrl_PT(e,t,i,r,u):"cj"===n?this._appendNameValueToUrl_CJ(e,t,i,r,u):"td"===n?this._appendNameValueToUrl_TD(e,t,i,r,u):(u="/"+r+"/"+u,this._insertToString(e,u,e.length));if(-1===(l=1==o?e.toLocaleLowerCase().indexOf(r.toLocaleLowerCase()+encodeURIComponent("=").toLocaleLowerCase()):e.toLocaleLowerCase().indexOf(r.toLocaleLowerCase()+"="))){a="=";var f="?";return-1!==e.indexOf("?")&&(f="&"),!0===o&&(f=encodeURIComponent(f),a=encodeURIComponent(a)),u=f+r+a+u,this._insertToString(e,u,e.length)}return 1==o?-1===(d=e.indexOf(encodeURIComponent("&").toLocaleLowerCase(),l))&&(d=e.indexOf("&",l)):d=e.indexOf("&",l),-1===d&&(d=e.length),(_=e.substring(l+r.length+1,d)).length>0&&(u=1==o?encodeURIComponent(this._getDelimiter(e,n)+u):this._getDelimiter(e,n)+u),this._insertToString(e,u,d)}return s?e+=t+"/"+i:-1!==e.indexOf("?")?e+="&"+t+"="+i:e+="?"+t+"="+i,e}_appendNameValueToUrl_TD(e,t,i,r,s){let n,a,o,l,d;return-1===(n=e.indexOf("epi("))?-1!==(n=e.indexOf("url("))?e+"epi("+s+")":-1===(o=e.indexOf("&epi="))?e+"&epi="+s:-1===(l=e.indexOf("&",o+5))?e+this._getDelimiter(e)+s:(s=this._getDelimiter(e)+s,this._insertToString(e,s,l)):(n+=r.length,-1!==(a=e.indexOf(")",n))?((d=e.substring(n,a)).length>0&&(s=this._getDelimiter(e)+s),this._insertToString(e,s,a)):e)}_appendNameValueToUrl_PT(e,t,i,r,s){let n,a,o;return-1!==(n=e.indexOf(r))?(n+=r.length,-1!==(a=e.indexOf("/",n))?((o=e.substring(n,a)).length>0&&(s=this._getDelimiter(e)+s),this._insertToString(e,s,a)):((o=e.substring(n,e.length)).length>0&&(s=this._getDelimiter(e)+s),this._insertToString(e,s,e.length))):-1!==(n=e.indexOf("/destination"))?(s="/pubref:"+s,this._insertToString(e,s,n)):(s="/pubref:"+s,this._insertToString(e,s,e.length));return e}_appendNameValueToUrl_CJ(e,t,i,r,s){let n=e.indexOf("dlg/");if(-1===n&&(n=e.indexOf("/am/")),s=s.replace(":","-"),-1!==n)return s=r+"/"+s+"/",this._insertToString(e,s,n+4);if(-1===e.indexOf("?"))return e+"?sid="+s;{let t=e.indexOf("?"),i=e.indexOf("sid=",t+1);if(-1===i&&(i=e.indexOf("&sid=",t+1)),-1!==i){let t=e.indexOf("&",i+5);return-1===t?e+this._getDelimiter(e).replace("|",this._delimiter4)+s:(s=this._getDelimiter(e).replace("|",this._delimiter4)+s,this._insertToString(e,s,t))}return t===e.length-1?e+"sid="+s:e+"&sid="+s}}_checkPageUrlMatch(){return!!this._isEmpty(this._settings.detection_rules.page_url_filter)||location.href.includes(this._settings.detection_rules.page_url_filter)}_insertToString(e,t,i){let r,s;return(r=e.substring(0,i))+t+(s=i<e.length?e.substring(i):"")}_insertSubstringToString(e,t,i,r){let s,n;return(s=e.substring(0,i))+t+(n=e.substring(r))}_parseQuery(e){let t=new Map;if(!e)return t;const i=e.split(/[;&]/);for(let e=0;e<i.length;e++){let r=i[e].split("=");if(!r||2!==r.length)continue;const s=unescape(r[0]);let n=unescape(r[1]);n=n.replace(/\+/g," "),t.set(s,n)}return t}_getAnchorLabel(e,t){let i=document.createElement("label");i.innerHTML=e.innerHTML,i.normalize();let r=i.innerHTML;return(r=r.trim()).length>t&&(r=r.substring(0,t)+"..."),r}_isEmpty(e){return null==e||""===e||void 0===e}_emptyIfNull(e){return null==e?"":e}_isAbsolute(e){return 0===e.indexOf("http://")||0===e.indexOf("https://")}_asBoolean(e){return"true"===e||!0===e}_generateUUID(){const e=Date.now(),t=String.fromCharCode(Math.floor(10*Math.random()+97)),i=String.fromCharCode(Math.floor(10*Math.random()+97)),r=String.fromCharCode(Math.floor(10*Math.random()+97));return`fr${e}${t}${i}${r}`}static _getObjectByPath(e,t){null==t&&(t=window);const i=e.split(".");if(1===i.length)return t[i[0]];{let e=t;for(let t=0;t<i.length;t++){const r=i[t];if("window"!==r&&(null==(e=e[r])&&t<i.length-1))return null}return e}}_getDelimiter(e,t){return e.includes("assoc-redirect.amazon")?this._delimiter2:this._isCJ(e)?this._delimiter4:"ho"==t||"at"==t?encodeURI(this._delimiter1):"tt"==t&&-1===e.indexOf("tc.tradetracker.net")?this._delimiter4:"bol"==t?this._delimiter4:"rv"==t?this._delimiter4:"afs"==t?this._delimiter4:this._delimiter1}_runFRCallback(){try{null!=window.funnelRelayReady&&"function"==typeof window.funnelRelayReady&&window.funnelRelayReady()}catch(e){this._error("Fail to run callback function 'funnelRelayReady'. Details: "+e)}}},trx.get={};trx.get.pageViewGuid = function(){return eval("pageData.pageViewGuid");},trx.GATracker=class{constructor(e){this.gaCode=e,window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create",this.gaCode,"auto","mlTracker",{alwaysSendReferrer:!0,allowAnchor:!1}),ga("mlTracker.set","referrer",document.referrer),ga("mlTracker.set","appName","trackonomics-relay")}trackEvent(e,t,i,r,s){ga(function(n){ga("mlTracker.send","event",{eventCategory:e,eventAction:t,eventLabel:i,eventValue:r,fieldsObject:s,transport:"beacon"})})}trackScreenView(e){ga(function(t){ga("mlTracker.send","screenview",{screenName:e,appId:this.appId,appVersion:this.appVersion,appName:this.appName})})}trackPageView(){ga(function(e){ga("mlTracker.set","page",location.href),ga("mlTracker.send","pageview",{page:location.href,title:document.title})})}},trx.AdobeTracker=class{constructor(e){null!=e&&e.length>0?this._rsId=e:this._rsId=null}trackEvent(e,t,i,r,n){if("function"==typeof s.tl){let e=s,t=null!=this._rsId?this._rsId:s_account;null!=t&&(e=s_gi(t));let i=n.props_map;null==i&&(i={xid:"prop1",link:"prop2",label:"prop3",referrer:"prop4",origin:"prop5"});let r=n.props_map_custom,a=[i.xid,i.link,i.label,i.referrer,i.origin];if(null!=r)for(let e=0;e<r.length;e++){let t=r[e];a.push(t.prop)}if(e.linkTrackVars=a.join(","),e[i.xid]=n.xid,e[i.link]=n.anchor.href,e[i.label]=n.anchor.innerHTML,e[i.referrer]=document.referrer,e[i.origin]=location.href,null!=r)for(let t=0;t<r.length;t++){let i=r[t];e[i.prop]=trx.MagicLinks._getObjectByPath(i.field,n.data)}e.linkTrackEvents="funnel-relay",e.events="funnel-relay";let o="funnel-relay-"+n.xid;e.tl(!0,"o",o,null)}}trackScreenView(e){}trackPageView(){}};let e=void 0,t="prod",i=!0,r=document.getElementById("funnel-relay-installer");null!=r&&r.hasAttribute("data-autorun")&&(i="false"!==r.getAttribute("data-autorun"));let n=3e3,a="{START_DELAY}",o=parseInt("{START_DELAY}");Number.isInteger(o)&&(n=o),void 0==trx.global_trace&&(trx.global_trace=[]),n>0?setTimeout(()=>{trx.magicLinksEngine=new trx.MagicLinks(i),trx.magicLinksEngine._runFRCallback()},n):(trx.magicLinksEngine=new trx.MagicLinks(i),trx.magicLinksEngine._runFRCallback())}();